* COMMENT fsharp

#+begin_src emacs-lisp
(use-package fsharp-mode
  :mode "\\.fsx\\'"
  :custom
  (fsharp-tab-always-indent nil)
  :defer t)
#+end_src

Ideally, the following would work:

(add-to-list 'eglot-server-programs `(fsharp-mode . ("fsautocomplete" "--adaptive-lsp-server-enabled")))

Though, things aren't ideal and eglot-fsharp does some helpful work.
So, to prevent attempts to manage the server, overrides are made to a few functions.
Either override is sufficient at time of writing, though I expect fixing the lastest version to installed to be most robust.

#+begin_src emacs-lisp
(use-package eglot-fsharp
  :after fsharp-mode
  :config
  (setq eglot-fsharp-server-install-dir nil)

  (defun eglot-fsharp--latest-version ()
    ;; Overriden to return the installed version
    (eglot-fsharp--installed-version))
  (defun eglot-fsharp--maybe-install (&optional version)
    ;; Overriden to prevent installation
    nil))
#+end_src


** COMMENT lsp-mode
*** lsp-mode
#+begin_src emacs-lisp
(use-package lsp-mode
  :after envrc
  :init
  ;; set prefix for lsp-command-keymap (few alternatives - "C-l", "C-c l")
  (setq lsp-keymap-prefix "C-c l m")
  (defun lsp-mode-setup-completion ()
    (setf (alist-get 'styles (alist-get 'lsp-capf completion-category-defaults)) '(orderless)))

  :custom
  (lsp-auto-execute-action nil)

  (lsp-eldoc-enable-hover t)
  (lsp-eldoc-render-all t)

  (lsp-enable-folding nil)
  (lsp-enable-indentation nil)
  (lsp-enable-on-type-formatting nil)
  (lsp-enable-suggest-server-download nil)
  (lsp-enable-xref t)

  (lsp-headerline-breadcrumb-enable nil)

  (lsp-keep-workspace-alive nil)

  (lsp-modeline-code-actions-enable nil)
  (lsp-modeline-diagnostics-scope :file)

  (lsp-signature-auto-activate '(:on-server-request))
  (lsp-signature-doc-lines 0)
  (lsp-signature-mode t)
  (lsp-signature-render-documentation nil)

  (lsp-treemacs-sync-mode nil)

  :hook ((lsp-mode . lsp-enable-which-key-integration))

  :commands (lsp lsp-deferred))

;; (defun lsp-if-in-workspace ()
;;   (interactive "D")
;;   (if (lsp-workspace-root default-directory) (lsp)))

;; (when (featurep 'lsp-mode)
;;   (add-hook 'prog-mode-hook 'lsp-if-in-workspace))

;; optionally if you want to use debugger
;; (use-package dap-mode)
;; (use-package dap-LANGUAGE) to load the dap adapter for your language

#+end_src

#+begin_src emacs-lisp
(defun global-disable-mode (mode-toggle)
  (interactive "a")
  (dolist (buffer (buffer-list))
    (with-current-buffer buffer
      (funcall mode-toggle -1))))

;; (defun lsp-tmp ()
;;   (interactive)
;;   (mapcar
;;    (lambda (buffer) (with-current-buffer buffer
;;                       (if (and (eq lsp-mode t) (not (lsp-workspace-root default-directory)))
;;                           (funcall lsp-disconnect)
;;                           (funcall lsp-mode -1)
;;                           (message "Disabled lsp-mode for " (buffer-name buffer)))))
;;    (buffer-list)))

#+end_src
*** tempel

#+begin_src emacs-lisp
(use-package lsp-snippet-tempel
  :vc (lsp-snippet-tempel :url "https://github.com/svaante/lsp-snippet"
                          :rev :newest)
  :after lsp-mode

  :config
  (when (featurep 'lsp-mode)
    (lsp-snippet-tempel-lsp-mode-init))
)
#+end_src
*** consult

  #+begin_src emacs-lisp
(use-package consult-lsp
  :after lsp-mode)
#+end_src

- python

  #+begin_src emacs-lisp
(use-package lsp-pyright
  :defer t
  :custom (lsp-pyright-langserver-command "pyright")
  :hook (python-mode . (lambda ()
                         (require 'lsp-pyright)
                         (lsp-deferred))))

#+end_src
